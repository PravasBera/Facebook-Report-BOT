<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FB Auto Reporter — UI</title>

<!-- Simple Google font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --accent:#2b6ef6;
    --muted:#6b7280;
    --shadow: 0 10px 30px rgba(10,20,40,0.06);
    --radius:14px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; background:var(--bg); color:#0b1220;}
  .container{max-width:980px;margin:18px auto;padding:18px;}
  .header{
    background:linear-gradient(90deg,#2047f0 0%, #3aa0ff 100%);
    color:white;border-radius:12px;padding:18px;box-shadow:var(--shadow);display:flex;gap:12px;align-items:center;justify-content:space-between;
  }
  .brand { font-weight:800;font-size:1.15rem; }
  .subtitle{font-size:0.86rem;opacity:0.95}
  /* token */
  .token-card{margin:18px 0;background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;gap:12px;align-items:center;}
  .token-input{flex:1;border:none;padding:12px;border-radius:10px;font-weight:700;font-size:1rem;background:#f2f5ff;border:1px solid #e6edff}
  .token-btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
  /* report type */
  .report-type{display:flex;gap:10px;justify-content:center;margin:14px 0}
  .radio-btn{display:flex;align-items:center;gap:10px;background:var(--card);padding:10px 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;box-shadow:0 6px 18px rgba(12,20,40,0.03)}
  .radio-btn input{transform:scale(1.1)}
  .radio-btn.active{border-color:rgba(43,110,246,0.16);box-shadow:0 10px 30px rgba(43,110,246,0.08)}
  /* options */
  .panel{margin:14px 0;display:flex;gap:18px;align-items:flex-start}
  .left{flex:1}
  .right{width:320px;min-width:260px}
  .options-block{background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:12px;transition:all .22s ease}
  .options-block h3{margin:0 0 8px;font-size:1rem}
  .opt{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid #f0f2f6;background:#fff;margin-bottom:8px}
  .opt input{width:20px;height:20px}
  .btn{display:inline-block;background:var(--accent);color:#fff;padding:12px 16px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
  .btn.ghost{background:#fff;color:var(--accent);border:1px solid #dbe6ff}
  .small-muted{font-size:0.9rem;color:var(--muted)}
  .selected-count{margin-top:8px;font-weight:700;color:#2b2f36;text-align:center}
  /* responsive */
  @media (max-width:880px){
    .panel{flex-direction:column}
    .right{width:100%}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="brand">⚡ Facebook Automation Tool</div>
        <div class="subtitle">Author: PRAVAS BERA — Version: Premium</div>
      </div>
      <div class="subtitle">Country: INDIA</div>
    </div>

    <!-- Admin token -->
    <div class="token-card">
      <input id="adminToken" class="token-input" placeholder="Enter Admin Token here (x-admin-token)" />
      <button id="saveToken" class="token-btn">Save</button>
    </div>

    <!-- report type -->
    <div class="report-type" role="radiogroup">
      <label class="radio-btn active">
        <input type="radio" name="reportType" value="profile" checked /> <span>Profile</span>
      </label>
      <label class="radio-btn">
        <input type="radio" name="reportType" value="page" /> <span>Page</span>
      </label>
      <label class="radio-btn">
        <input type="radio" name="reportType" value="post" /> <span>Post</span>
      </label>
    </div>

    <div class="panel">
      <div class="left">
        <!-- target url / id -->
        <div class="options-block">
          <h3>Target URL / ID</h3>
          <input id="target" placeholder="https://facebook.com/..." style="width:100%;padding:12px;border-radius:10px;border:1px solid #eee;font-weight:700" />
        </div>

        <!-- options - these three blocks shown/hidden by type -->
        <div id="options-profile" class="options-block" data-type="profile">
          <h3>Profile Report Options</h3>
          <label class="opt"><input type="checkbox" name="profileOpt" value="under18"> Problem involving someone under 18</label>
          <label class="opt"><input type="checkbox" name="profileOpt" value="bullying"> Bullying, harassment or abuse</label>
          <label class="opt"><input type="checkbox" name="profileOpt" value="violent"> Violent, hateful or disturbing content</label>
          <label class="opt"><input type="checkbox" name="profileOpt" value="adult"> Adult content</label>
          <label class="opt"><input type="checkbox" name="profileOpt" value="fake"> Fake profile</label>
        </div>

        <div id="options-page" class="options-block" data-type="page" hidden>
          <h3>Page Report Options</h3>
          <label class="opt"><input type="checkbox" name="pageOpt" value="under18"> Problem involving someone under 18</label>
          <label class="opt"><input type="checkbox" name="pageOpt" value="bullying"> Bullying, harassment or abuse</label>
          <label class="opt"><input type="checkbox" name="pageOpt" value="violent"> Violent, hateful or disturbing content</label>
          <label class="opt"><input type="checkbox" name="pageOpt" value="adult"> Adult content</label>
          <label class="opt"><input type="checkbox" name="pageOpt" value="fake"> Fake page</label>
        </div>

        <div id="options-post" class="options-block" data-type="post" hidden>
          <h3>Post Report Options</h3>
          <label class="opt"><input type="checkbox" name="postOpt" value="under18"> Problem involving someone under 18</label>
          <label class="opt"><input type="checkbox" name="postOpt" value="bullying"> Bullying, harassment or abuse</label>
          <label class="opt"><input type="checkbox" name="postOpt" value="violent"> Violent, hateful or disturbing content</label>
          <label class="opt"><input type="checkbox" name="postOpt" value="adult"> Adult content</label>
        </div>
      </div>

      <div class="right">
        <div class="options-block">
          <h3>Cookies upload</h3>
          <input id="cookiesFile" type="file" accept=".txt" style="width:100%" />
          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="uploadCookies" class="btn ghost" style="flex:1">Upload Cookies</button>
            <button id="startReport" class="btn" style="flex:1">Start</button>
          </div>
          <div class="small-muted" style="margin-top:10px">Each line in cookies.txt = one cookie string</div>
        </div>

        <div class="options-block">
          <h3>Live</h3>
          <div id="selected-count" class="selected-count">Selected: 0</div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // UI wiring
  const radioLabels = Array.from(document.querySelectorAll('.radio-btn'));
  const radios = Array.from(document.querySelectorAll('input[name="reportType"]'));
  const blocks = Array.from(document.querySelectorAll('.options-block[data-type]'));
  const countBox = document.getElementById('selected-count');
  const saveToken = document.getElementById('saveToken');
  const adminTokenInput = document.getElementById('adminToken');

  // load token if saved (localStorage)
  adminTokenInput.value = localStorage.getItem('adminToken') || '';

  saveToken.addEventListener('click', () => {
    localStorage.setItem('adminToken', adminTokenInput.value.trim());
    alert('Token saved locally (for this browser).');
  });

  function setActiveLabel(value){
    radioLabels.forEach(lbl=>{
      const inp = lbl.querySelector('input');
      if(inp.value === value) lbl.classList.add('active'); else lbl.classList.remove('active');
    });
  }

  function showBlock(type){
    blocks.forEach(b => {
      if (b.dataset.type === type){
        b.removeAttribute('hidden');
        b.style.opacity = 1;
        b.style.transform = 'translateY(0)';
      } else {
        b.setAttribute('hidden','');
        b.style.opacity = 0;
        b.style.transform = 'translateY(8px)';
        // optional: clear other selections to avoid stale choices
        b.querySelectorAll('input[type=checkbox]').forEach(cb => cb.checked = false);
      }
    });
    updateCount();
  }

  function updateCount(){
    const visible = blocks.find(b => !b.hasAttribute('hidden'));
    if(!visible) { countBox.textContent = 'Selected: 0'; return; }
    const checked = visible.querySelectorAll('input[type=checkbox]:checked').length;
    countBox.textContent = `Selected: ${checked}`;
  }

  // radio change handlers
  radios.forEach(r => r.addEventListener('change', () => {
    if (r.checked) {
      setActiveLabel(r.value);
      showBlock(r.value);
    }
  }));
  // clicking labels toggles input checked (UX)
  radioLabels.forEach(lbl => {
    lbl.addEventListener('click', () => {
      const inp = lbl.querySelector('input');
      inp.checked = true;
      inp.dispatchEvent(new Event('change'));
    });
  });

  // checkbox change
  blocks.forEach(b => b.addEventListener('change', (e) => {
    if (e.target && e.target.type === 'checkbox') updateCount();
  }));

  // initial
  const initial = document.querySelector('input[name="reportType"]:checked');
  setActiveLabel(initial.value);
  showBlock(initial.value);

  // Start button — gather data and POST to server
  document.getElementById('startReport').addEventListener('click', async () => {
    const type = document.querySelector('input[name="reportType"]:checked').value;
    const target = document.getElementById('target').value.trim();
    if(!target){ alert('Enter target URL / ID first'); return; }

    // collect checked options for visible block
    const visible = blocks.find(b => !b.hasAttribute('hidden'));
    const opts = Array.from(visible.querySelectorAll('input[type=checkbox]:checked')).map(i => i.value);

    // cookies file (optional)
    const cookiesFileEl = document.getElementById('cookiesFile');
    let cookiesText = null;
    if (cookiesFileEl.files && cookiesFileEl.files.length){
      cookiesText = await cookiesFileEl.files[0].text();
    }

    const payload = {
      type,
      target,
      options: opts,
      cookies: cookiesText // optional: server can parse
    };
    const adminToken = localStorage.getItem('adminToken') || adminTokenInput.value.trim();

    // show minimal UI feedback
    document.getElementById('startReport').textContent = 'Starting...';
    document.getElementById('startReport').disabled = true;

    try {
      const res = await fetch('/report', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...(adminToken ? {'x-admin-token': adminToken} : {})
        },
        body: JSON.stringify(payload),
      });
      if (!res.ok) {
        const text = await res.text();
        alert('Server error: ' + text);
      } else {
        const j = await res.json();
        alert('Started ✓ — server response: ' + (j.message || JSON.stringify(j)));
      }
    } catch (err){
      alert('Request failed: ' + err.message);
    } finally {
      document.getElementById('startReport').textContent = 'Start';
      document.getElementById('startReport').disabled = false;
    }
  });

  // upload cookies button (optional quick demo)
  document.getElementById('uploadCookies').addEventListener('click', async () => {
    const f = document.getElementById('cookiesFile').files[0];
    if(!f){ alert('Choose cookies.txt first'); return; }
    const txt = await f.text();
    alert('Cookies loaded: ' + (txt.length>200 ? txt.slice(0,200)+'...' : txt) );
  });

})();
</script>
</body>
</html>
